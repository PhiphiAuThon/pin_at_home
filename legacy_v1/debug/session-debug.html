<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Session Debug</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #0a0a0a;
      color: #fff;
      padding: 2rem;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 { color: #e60023; }
    button {
      background: #e60023;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }
    button:hover { background: #ff1744; }
    #output {
      background: rgba(255,255,255,0.1);
      padding: 1rem;
      border-radius: 8px;
      margin-top: 1rem;
      white-space: pre-wrap;
      font-size: 0.9rem;
    }
    .success { color: #4ade80; }
    .error { color: #ff6b6b; }
    .warning { color: #ffd93d; }
  </style>
</head>
<body>
  <h1>üîç Pinterest Session Debugger</h1>
  <p>Use this page to debug session detection issues.</p>
  
  <button onclick="checkSession()">Check Session</button>
  <button onclick="listAllCookies()">List All Pinterest Cookies</button>
  <button onclick="testFetch()">Test Fetch</button>
  <button onclick="clearOutput()">Clear</button>
  
  <div id="output">Click a button to start debugging...</div>

  <script>
    const output = document.getElementById('output');
    
    function log(message, type = 'normal') {
      const timestamp = new Date().toLocaleTimeString();
      const className = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
      output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
    }
    
    function clearOutput() {
      output.innerHTML = '';
    }
    
    async function checkSession() {
      log('üîç Checking session via background script...', 'normal');
      
      try {
        const response = await chrome.runtime.sendMessage({ action: 'checkSession' });
        
        if (response.success) {
          if (response.loggedIn) {
            log('‚úÖ Session check: LOGGED IN', 'success');
          } else {
            log('‚ùå Session check: NOT LOGGED IN', 'error');
          }
        } else {
          log(`‚ùå Error: ${response.error}`, 'error');
        }
      } catch (error) {
        log(`‚ùå Exception: ${error.message}`, 'error');
      }
    }
    
    async function listAllCookies() {
      log('üìã Fetching all Pinterest cookies...', 'normal');
      
      try {
        const cookies = await chrome.cookies.getAll({
          url: 'https://www.pinterest.com'
        });
        
        if (cookies.length === 0) {
          log('‚ö†Ô∏è No Pinterest cookies found!', 'warning');
          log('   ‚Üí Are you logged in to Pinterest?', 'warning');
        } else {
          log(`Found ${cookies.length} cookies:`, 'success');
          cookies.forEach(cookie => {
            const value = cookie.value.length > 50 ? cookie.value.substring(0, 50) + '...' : cookie.value;
            log(`   ‚Ä¢ ${cookie.name}: ${value}`);
          });
        }
      } catch (error) {
        log(`‚ùå Error listing cookies: ${error.message}`, 'error');
      }
    }
    
    async function testFetch() {
      log('üåê Testing fetch to Pinterest...', 'normal');
      
      try {
        const response = await fetch('https://www.pinterest.com/', {
          credentials: 'include'
        });
        
        log(`Response status: ${response.status}`, response.ok ? 'success' : 'error');
        
        const html = await response.text();
        const hasUserData = html.includes('"username":');
        const hasAuthFlag = html.includes('"isAuthenticated":true');
        const hasPwsData = html.includes('__PWS_DATA__');
        
        log(`Has username: ${hasUserData ? '‚úÖ' : '‚ùå'}`, hasUserData ? 'success' : 'error');
        log(`Has auth flag: ${hasAuthFlag ? '‚úÖ' : '‚ùå'}`, hasAuthFlag ? 'success' : 'error');
        log(`Has PWS data: ${hasPwsData ? '‚úÖ' : '‚ùå'}`, hasPwsData ? 'success' : 'error');
        
        if (hasUserData || hasAuthFlag || hasPwsData) {
          log('‚úÖ You appear to be logged in!', 'success');
        } else {
          log('‚ùå You appear to be logged out', 'error');
        }
      } catch (error) {
        log(`‚ùå Fetch error: ${error.message}`, 'error');
      }
    }
  </script>
</body>
</html>
